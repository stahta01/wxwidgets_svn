#!/bin/bash

#----------------------------------------------------------------------

if [ -z $1 ]; then
    echo "Please specify a version number on the command line."
    exit 1
fi

if [ ! -d wxPython ]; then  # TODO: make this test more robust
    echo "Please run this script from the root wxPython directory."
    exit 1
fi


CONTRIBS="ogl gizmos"

# **** Make a directory to build up a distribution tree

DEST=wxPython-$1/docs

mkdir -p _build_docs/$DEST
cd _build_docs
mkdir $DEST/wx

WXDIR=../..

# **** Build the main docs using tex2rtf
echo "****" main "****"
cp $WXDIR/docs/latex/wx/*.gif $DEST/wx
$WXDIR/utils/tex2rtf/src/tex2rtf $WXDIR/docs/latex/wx/manual.tex $DEST/wx/wx.htm -twice -html -macros $WXDIR/docs/latex/wx/tex2rtf.ini
cp $DEST/wx/wx.htm $DEST/wx/index.htm

# **** and the contribs
for c in $CONTRIBS; do
    echo "****" $c "****"
    mkdir $DEST/$c
    cp $WXDIR/contrib/docs/latex/$c/*.gif $DEST/$c
    cp $WXDIR/contrib/docs/latex/$c/*.bmp $DEST/$c
    $WXDIR/utils/tex2rtf/src/tex2rtf $WXDIR/contrib/docs/latex/$c/$c.tex $DEST/$c/$c.htm -twice -html -macros $WXDIR/docs/latex/wx/tex2rtf.ini
    cp $DEST/$c/$c.htm $DEST/$c/index.htm || cp $DEST/$c/${c}_contents.html $DEST/$c/index.htm
done


# **** zip the docs into "books"
pushd $DEST
pushd wx
zip ../wx.zip *
popd
rm -r wx

for c in $CONTRIBS; do
    pushd $c
    zip ../$c.zip *
    popd
    rm -r $c
done

popd
cp ../distrib/viewdocs.py $DEST
cp ../distrib/README.viewdocs.txt $DEST/README.txt

rm -f ../dist/wxPythonDocs-$1.tar.gz
tar cvf ../dist/wxPythonDocs-$1.tar $DEST
gzip -9 ../dist/wxPythonDocs-$1.tar


# **** Cleanup
cd ..
rm -r _build_docs


