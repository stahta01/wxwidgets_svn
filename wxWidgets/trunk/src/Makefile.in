#
#  wxWindows/Unix main source makefile
#
#  Copyright 1998, Markus Holzhem and Robert Roebling
#

# wxWindows base directory
WXBASEDIR=@WXBASEDIR@

# set the OS type for compilation
OS=@OS@

# compile a library only
RULE=gslib

# define common stuff

# include gtk.inc, qt.inc or motif.inc here
include @MAKEINCLUDE@

LIB_CPP_ALL_SRC=$(LIB_CPP_SRC) @GTK_JOYSTICK@ @UNIX_THREAD@

LIB_C_ALL_SRC=$(LIB_C_SRC) parser.c

#define library objects
LIB_OBJ=\
 $(LIB_CPP_ALL_SRC:.cpp=.o) \
 $(LIB_C_ALL_SRC:.c=.o)

all::
	@if test ! -d gtk; then mkdir gtk; fi
	@if test ! -d qt; then mkdir qt; fi
	@if test ! -d motif; then mkdir motif; fi
	@if test ! -d common; then mkdir common; fi
	@if test ! -d generic; then mkdir generic; fi
	@if test ! -d png; then mkdir png; fi
	@if test ! -d zlib; then mkdir zlib; fi
	@if test ! -d gdk_imlib; then mkdir gdk_imlib; fi
	@if test ! -d iodbc; then mkdir iodbc; fi

install::
	@echo "Installing library files and headers.."
	@echo "  Creating directories.."
	@$(WXBASEDIR)/mkinstalldirs \
	   /usr/local/include/wx \
	   /usr/local/include/wx/gtk \
	   /usr/local/include/wx/common \
	   /usr/local/include/wx/generic
	@echo "  Copying headers from /include/wx"
	@cd $(WXBASEDIR)/include/wx ; \
	for f in *.h ; do \
	  rm -f /usr/local/include/wx/$$f ; \
	  $(INSTALL_DATA) $$f /usr/local/include/wx/$$f ; \
	done
	@echo "  Copying headers from /include/wx/gtk"
	@cd $(WXBASEDIR)/include/wx/gtk ; \
	for f in *.h ; do \
	  rm -f /usr/local/include/wx/gtk/$$f ; \
	  $(INSTALL_DATA) $$f /usr/local/include/wx/gtk/$$f ; \
	done
	@echo "  Copying headers from /include/wx/generic"
	@cd $(WXBASEDIR)/include/wx/generic ; \
	for f in *.h ; do \
	  rm -f /usr/local/include/wx/generic/$$f ; \
	  $(INSTALL_DATA) $$f /usr/local/include/wx/generic/$$f ; \
	done
	@echo "  Copying static libraries files to /usr/local/lib"
	@cd $(WXBASEDIR)/lib/$(OS) ; \
	for f in libwx_gtk.a ; do \
	  rm -f /usr/local/lib/$$f ; \
	  $(INSTALL_DATA) $$f /usr/local/lib/$$f ; \
	done
	@echo "  Copying shared libraries to /usr/local/lib"
	@cd $(WXBASEDIR)/lib/$(OS) ; \
	for f in libwx_gtk.so* ; do \
	  rm -f /usr/local/lib/$$f ; \
	  $(INSTALL_PROGRAM) $$f /usr/local/lib/$$f ; \
	done
	
clean::
	$(RM) -rf gtk
	$(RM) -rf qt
	$(RM) -rf motif
	$(RM) -rf common
	$(RM) -rf generic
	$(RM) -rf png
	$(RM) -rf zlib
	$(RM) -rf gdk_imlib
	$(RM) -rf iodbc
	@$(RM) lexer.c parser.c

#additional things needed for compile
ADD_COMPILE= \
   -DHAVE_LIBPNG -DDJPEG_PROG=\"\" -DCJPEG_PROG=\"\"

# include the definitions now
include ../../template.mak

# things for the prolog stuff

parser.c: ../common/parser.y lexer.c 
	@if test ! -f parser.y; then \
	  cp -f ../common/parser.y . ; \
	fi
	@$(YACC) parser.y
	@sed -e "s/y.tab.c/parser.y/g"       < y.tab.c | \
	sed -e "s/BUFSIZ/5000/g"            | \
	sed -e "s/YYLMAX 200/YYLMAX 5000/g" | \
	sed -e "s/yy/PROIO_yy/g"            | \
	sed -e "s/input/PROIO_input/g"      | \
	sed -e "s/unput/PROIO_unput/g"      > parser.c
	@$(RM) y.tab.c
	@$(RM) parser.y

lexer.c: ../common/lexer.l
	@if test ! -f lexer.l; then \
	  cp -f ../common/lexer.l . ;\
	fi
	@$(LEX) lexer.l
	@sed -e "s/lex.yy.c/lexer.l/g"       < lex.yy.c | \
	sed -e "s/yy/PROIO_yy/g"            | \
	sed -e "s/input/PROIO_input/g"      | \
	sed -e "s/unput/PROIO_unput/g"      > lexer.c
	@$(RM) lex.yy.c
	@$(RM) lexer.l

clean::
	