#! /bin/sh

#LIBRARY_BASE=`echo $1 | sed 's/.a/.so/'`
COMPILER=$1
LIBRARY_BASE=$2
LIBRARY_MAJOR=$3
LIBRARY_MINOR=$4
shift 3
LIBRARY_OBJS=
while (test $# -ne 1) do
  shift;
  LIBRARY_OBJS="$LIBRARY_OBJS $1sh";
done

LIBRARY_NAME=`basename $LIBRARY_BASE`
LIBRARY_FILE=$LIBRARY_BASE.$LIBRARY_MAJOR.$LIBRARY_MINOR

echo "Creating shared library: $LIBRARY_FILE"

if test "x$COMPILER" = xgcc ; then
  gcc -shared -o $LIBRARY_FILE $LIBRARY_OBJS
else
  CC -Bshareable -Bforcearchive -o $LIBRARY_FILE $LIBRARY_OBJS
fi
chmod a+x $LIBRARY_FILE
rm -f $LIBRARY_BASE.$LIBRARY_MAJOR
ln -s $LIBRARY_NAME.$LIBRARY_MAJOR.$LIBRARY_MINOR $LIBRARY_BASE.$LIBRARY_MAJOR
rm -f $LIBRARY_BASE
ln -s $LIBRARY_NAME.$LIBRARY_MAJOR $LIBRARY_BASE




