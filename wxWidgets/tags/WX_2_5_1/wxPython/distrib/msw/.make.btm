@echo off
setlocal


iff "%1" == "both" then
	shift
	call .make debug %$      & if %? != 0 quit $?
	call .make hybrid %$     & if %? != 0 quit $?
	quit

elseiff "%1" == "both-uni" then
	shift
	call .make debug-uni %$  & if %? != 0 quit $?
	call .make hybrid-uni %$ & if %? != 0 quit $?
	quit

elseiff "%1" == "both-hybrid" then
	shift
	call .make hybrid %$     & if %? != 0 quit $?
	call .make hybrid-uni %$ & if %? != 0 quit $?
	quit

elseiff "%1" == "all" then
	shift
	call .make debug %$      & if %? != 0 quit $?
	call .make hybrid %$     & if %? != 0 quit $?
	call .make debug-uni %$  & if %? != 0 quit $?
	call .make hybrid-uni %$ & if %? != 0 quit $?
	quit

elseiff "%1" == "debug" then
	set BUILD_TYPE=%1
	set WXLIBDIR=mswd
	shift

elseiff "%1" == "hybrid" then
	set BUILD_TYPE=%1
	set WXLIBDIR=mswh
	shift

elseiff "%1" == "release" then
	set BUILD_TYPE=%1
	set WXLIBDIR=msw
	shift

elseiff "%1" == "debug-uni" then
	set BUILD_TYPE=%1
	set WXLIBDIR=mswud
	shift

elseiff "%1" == "hybrid-uni" then
	set BUILD_TYPE=%1
	set WXLIBDIR=mswuh
	shift

elseiff "%1" == "release-uni" then
	set BUILD_TYPE=%1
	set WXLIBDIR=mswu
	shift

else
	echo Invalid build type: "%1"
	quit 1
endiff


echo ------------------
echo cd %WXWIN%\build\msw
cd %WXWIN%\build\msw
nmake -f .makesetup.mk %WXWIN%\lib\vc_dll\%WXLIBDIR%\wx\setup.h


echo ------------------
echo cd %WXWIN%\build\msw
cd %WXWIN%\build\msw
call %WXWIN%\build\msw\.mymake %BUILD_TYPE% %$
if %? != 0 goto done


echo ------------------
echo cd ..\..\contrib\build\gizmos
cd ..\..\contrib\build\gizmos
call %WXWIN%\build\msw\.mymake %BUILD_TYPE% %$
if %? != 0 goto done
cd -

echo ------------------
echo cd ..\..\contrib\build\xrc
cd ..\..\contrib\build\xrc
call %WXWIN%\build\msw\.mymake %BUILD_TYPE% %$
if %? != 0 goto done
cd -


echo ------------------
echo cd ..\..\contrib\build\stc
cd ..\..\contrib\build\stc
call %WXWIN%\build\msw\.mymake %BUILD_TYPE% %$
if %? != 0 goto done
cd -


echo ------------------
echo cd ..\..\contrib\build\ogl
cd ..\..\contrib\build\ogl
call %WXWIN%\build\msw\.mymake %BUILD_TYPE% CXX="cl -DwxUSE_DEPRECATED=0" %$
if %? != 0 goto done
cd -



@echo -----------------
@echo --   SUCCESS!  --
@echo -----------------
REM copy DLLs to a dir on the PATH
copy /U %WXWIN%\lib\vc_dll\*.dll %WXWIN%\BIN
copy /U %WXWIN%\lib\vc_dll\*.pdb %WXWIN%\BIN
quit 0


:done
@echo -----------------
@echo --    ERROR!   --
@echo -----------------
quit %?

