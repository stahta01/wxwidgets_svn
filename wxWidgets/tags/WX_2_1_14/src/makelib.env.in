#
# Template makefile for building wxWindows companion libraries.
#
# Author:   Ron Lee <ron@debian.org>
# Created:  19/3/2000
#
# To use, set the following vars before including it.
#
# TARGET_LIBNAME
# LIBVERSION_CURRENT
# LIBVERSION_REVISION
# LIBVERSION_AGE
#
# either a shared or static lib will be built according to the
# option given to configure.
#

prefix = @prefix@
exec_prefix = @exec_prefix@
libdir = @libdir@

INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

TARGETLIB_STATIC=$(TARGET_LIBNAME).a
TARGETLIB_SHARED=$(TARGET_LIBNAME).so.$(LIBVERSION_CURRENT).$(LIBVERSION_REVISION).$(LIBVERSION_AGE)
TARGETLIB_LINK1=$(TARGET_LIBNAME).so.$(LIBVERSION_CURRENT)
TARGETLIB_LINK2=$(TARGET_LIBNAME).so

# Clears all default suffixes
.SUFFIXES:	.o .cpp .c .cxx

.c.o :
	$(CCC) -c $(CFLAGS) $(PICFLAGS) -o $@ $<

.cpp.o :
	$(CC) -c $(CPPFLAGS) $(PICFLAGS) -o $@ $<

.cxx.o :
	$(CC) -c $(CPPFLAGS) $(PICFLAGS) -o $@ $<

include $(top_builddir)/src/make.env


all:    libtype_@WX_TARGET_LIBRARY_TYPE@

libtype_so: CREATE_LINKS

libtype_a: $(TARGETLIB_STATIC)


$(TARGETLIB_SHARED): $(OBJECTS)
	$(SHARED_LD) $@ $(OBJECTS)

CREATE_LINKS: $(TARGETLIB_SHARED)
	@$(RM) $(TARGETLIB_LINK1) $(TARGETLIB_LINK2)
	$(LN_S) $(TARGETLIB_SHARED) $(TARGETLIB_LINK1)
	$(LN_S) $(TARGETLIB_SHARED) $(TARGETLIB_LINK2)

$(TARGETLIB_STATIC): $(OBJECTS)
	ar $(AROPTIONS) $@ $(OBJECTS)
	$(RANLIB) $@

install: install_@WX_TARGET_LIBRARY_TYPE@

install_so:
	$(INSTALL_PROGRAM) $(TARGETLIB_SHARED) $(libdir)/$(TARGETLIB_SHARED)
	@$(RM) $(libdir)/$(TARGETLIB_LINK1) $(libdir)/$(TARGETLIB_LINK2)
	cd $(libdir) \
		&& $(LN_S) $(TARGETLIB_SHARED) $(TARGETLIB_LINK1) \
		&& $(LN_S) $(TARGETLIB_SHARED) $(TARGETLIB_LINK2)

install_a:
	$(INSTALL_PROGRAM) $(TARGETLIB_STATIC) $(libdir)/$(TARGETLIB_STATIC)

uninstall:
	$(RM) $(libdir)/$(TARGETLIB_STATIC)
	$(RM) $(libdir)/$(TARGETLIB_SHARED)
	$(RM) $(libdir)/$(TARGETLIB_LINK1)
	$(RM) $(libdir)/$(TARGETLIB_LINK2)

clean:
	$(RM) $(OBJECTS) $(TARGETLIB_SHARED) $(TARGETLIB_LINK1) \
	      $(TARGETLIB_LINK2) $(TARGETLIB_STATIC) core

.PHONY: all shared static clean install install_static install_shared uninstall

